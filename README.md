# Gemini TTS Plugin for AstrBot

这是一个为 AstrBot 设计的文本转语音 (TTS) 插件，它利用 Google Gemini API 的强大功能，将机器人（LLM）的文本回复自动转换为高质量的语音消息，提供更加生动和沉浸式的聊天体验。

插件最大的特色是内置了“配音总监”功能，它能智能分析文本中的情绪和动作描述（例如 `(小声)`、`*开心*` 等），并生成更具表现力的语音，让声音听起来不再是单调的机器朗读。
## ✨ 主要功能
- **语音合成**：基于 Google Gemini 先进的 TTS 模型生成自然流畅的语音。
- **自动语音转换**：开启后，可自动将 LLM 的文本回复转换为语音消息发送。
- **配音总监**：自动分析文本中的情绪和场景描述，智能生成带有情感、语气和语速变化的语音，让角色更具“灵魂”。
- **会话独立开关**：可以为每个群聊或私聊会话独立开启或关闭自动语音功能。
- **多密钥支持**：支持配置多个 Gemini API 密钥，并在某个密钥失效时自动切换，保证服务稳定性。
- **高度可配置**：支持自定义 API 地址、TTS 模型、默认音色等。

## 🚀 指令说明

本插件的核心指令非常简单，主要用于控制自动语音功能的开启和关闭。

### 开启自动语音

在群聊或与机器人的私聊中发送以下任意一条指令，即可为**当前会话**开启自动语音模式。开启后，所有由机器人 LLM 生成的回复都将附带一条语音消息。

- `/tts_auto on`
- `/gtts on`
- `/语音模式 on`

**示例:**
> **你:** /语音模式 on
>
> **机器人:** 本会话的自动语音功能已开启

### 关闭自动语音

在已开启自动语音的会话中，发送以下任意一条指令，即可关闭自动语音。关闭后，机器人将只回复纯文本消息。

- `/tts_auto off`
- `/gtts off`
- `/语音模式 off`

**示例:**
> **你:** /tts_auto off
>
> **机器人:** 本会话的自动语音功能已关闭

---

## 💡 工作原理 (配音总监)

当您开启自动语音模式后，插件会按以下流程工作：

1.  **拦截文本回复**：插件会获取到 LLM 原始的文本回复，例如 `(带着一丝慌乱) 减…减半？！你在胡说什么？！`。
2.  **请求配音指导**：插件会将这段原始文本发送给“配音总监”（一个内置的强大 Prompt），请求它分析文本内容。
3.  **生成 TTS 指令**：“配音总监”会分析出文本中的情绪（慌乱）、语气（难以置信）和角色特点，然后生成一条更专业的英文 TTS 指令，例如 `Read this in a high-pitched, panicked, and unbelieving tsundere voice: 减…减半？！你在胡说什么？！`。
4.  **合成语音**：插件使用这条优化后的指令去请求 Gemini TTS 服务，从而生成一段充满感情的语音。
5.  **发送消息**：最后，插件会将原始的文本消息和新生成的语音消息一起发送给您。

通过这个流程，即使是简单的文字，也能被赋予丰富的情感，极大地提升了交互的趣味性。

## ⚙️ 配置说明

您需要在 AstrBot 的插件配置中填写以下信息：

-   `gemini_api_keys`： (必需) 你的 Gemini API 密钥列表，可以填入一个或多个。
-   `api_base_url`：(可选) Gemini API 的代理地址。如果留空，将使用官方默认地址 `https://generativelanguage.googleapis.com`。
-   `model_id`: (可选) 使用的 TTS 模型 ID，默认为 `gemini-2.5-flash-preview-tts`。
-   `default_voice`: (可选) 默认使用的音色，格式为 `音色名 (描述)`，默认为 `Kore (女声 - 坚定自信)`。
-   `dubbing_director_prompt`: (可选) 自定义“配音总监”的系统提示词，高级用户可以根据自己的需求进行修改，以达到不同的配音效果。
